<html>
<head>
<title>Share to Browser</title>
<script type="text/javascript">


if (typeof XMLHttpRequest == "undefined")
XMLHttpRequest = function () {
  try { return new ActiveXObject("Msxml2.XMLHTTP.6.0"); }
  catch (e) {}
  try { return new ActiveXObject("Msxml2.XMLHTTP.3.0"); }
  catch (e) {}
  try { return new ActiveXObject("Msxml2.XMLHTTP"); }
  catch (e) {}
  //Microsoft.XMLHTTP points to Msxml2.XMLHTTP.3.0 and is redundant
  throw new Error("This browser does not support XMLHttpRequest.");
};

function doRequest(id) {
  if (inflight) return;
  var xhr = new XMLHttpRequest();
  inflight = true;
  xhr.onreadystatechange = function() {
    if (xhr.readyState != 4) return;
    inflight = false;

    if (xhr.status == 200 && xhr.responseText != "") {
      window.open(xhr.responseText);
      doRequest(id);
    }
  };
  xhr.open('GET', '/poll?browser=' + id, true);
  xhr.send(null);
}

function init() {
  id = '$$';
  inflight = false;
  qrUrl = "http://chart.apis.google.com/chart?cht=qr&" +
          "chs=350x350&chl=http%3A%2F%2F" +
          "share-to-browser.appspot.com%2Fassociate%3Fbrowser%3D" + id;
  document.getElementById("image").innerHTML = '<img align="left" src="' + qrUrl + '">';

  setInterval(function() {
    doRequest(id);
  }, 120000);
}
</script>
</head>

<body onload="init();">
<center><h1>Share to Browser</h1></center>
<h2>How to use it:</h2>
<ul>
<li>On your phone scan the displayed qr-code using <code>Barcode Scanner</code> app. Select open in Browser and choose <code>Share to Browser</code> application. This will associate your phone with the browser window.</li>
<li>Now you can 'Share' pages with 'Share to Browser' and new Windows/Tabs will open in this browser automatically.</li>
<li>Don't forget to disable popup blocker otherwise the windows or tabs will be blocks.</li>
<li>Try sending a page: in your phone <code>Browser</code>, press Menu -&gt; More -&gt; 'Share Page', select 'Share to Browser'. The browser window or tab should open next to this one within 2 minutes with the page you send.</li>

<li>You can bookmark this page and even open on other computer to access the links you send from you android device. <b><h3>If you close this page and forget the web address you will not have access to the links you've send.</h3></b>
</li>

</ul>
<span id="image"></span>
<h2>How it works:</h2>
  <ul>
  <li>
    When you scan qr-code your phone remembers the number generated by this browser window.
  </li>
  <li>
    When you share a page on your phone - it sends the link and your unique number to the 'share-to-browser.appspot.com'.
  </li> 
  <li>
    Every 2 minutes this browser window fetches new links from 'share-to-browser.appspot.com' and opens them in new windows.
  </li>
</ul>
</body>
